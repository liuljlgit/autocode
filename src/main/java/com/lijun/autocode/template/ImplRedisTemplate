package ${packageName};

import java.util.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Repository;
${importList}

/**
 * 缓存实现类 ${entityName}RedisImpl
 * @author lijun
 */
@Repository("${entityObj}Redis")
public class ${entityName}RedisImpl extends BaseRedis<String, ${entityName}> implements I${entityName}Redis{

    private static final Logger logger = LoggerFactory.getLogger(${entityName}RedisImpl.class);

    public final static String PRE_KEY = ${entityName}.class.getSimpleName();
    private final static String SET_${entityNameUpperCase}_KEY = "SET:".concat(PRE_KEY) ;

    /**
     * 得到redis的key值
     * @return
     * @throws Exception
     */
    public String get${entityName}Key(${paramIds}){
        return PRE_KEY.concat(":")${concatIds};
    }

    /**
     * 把值存储到redis中
     * 1.Key-Value对象
     * 2.把key存储到一个set中,方便删除操作
     */
    public String set${entityName}2Redis(${entityName} ${entityObj}, long expire){
        String primaryKey = get${entityName}Key(${objGetIds});
        sadd(SET_${entityNameUpperCase}_KEY, primaryKey);
        set(primaryKey, ${entityObj}, expire);
        return primaryKey ;
    }

    /**
     * 从缓存中得到值
     */
    @Override
    public ${entityName} get${entityName}ByKey(${paramIds}){
        String primaryKey = get${entityName}Key(${Ids});
        ${entityName} ${entityObj} = get(primaryKey,${entityName}.class);
        return ${entityObj};
    }

    /**
     * 删除所有redis中的值
     */
    public void clearAll${entityName}() {
        @SuppressWarnings("unchecked")
        List<String> listKey = (List<String>)smembers(SET_${entityNameUpperCase}_KEY) ;
        listKey.add(SET_${entityNameUpperCase}_KEY) ;
        if(listKey.size() > 0){
            delete(listKey) ;
        }
    }

}
